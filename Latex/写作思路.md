# 核心思想 #
本文的所有的核心思想都是围绕威胁模型图来构建，对于该图，目前的解析主要有如下的几点：
1. 攻击者的最重要的目的是危害其余的虚拟机，即图中的guest VM2。如何通过何种方式，具体危害哪种数据结构，最终的目的都是危害这台虚拟机，即与guest vm1共享同一个物理平台的其他的虚拟机。所以，画图中，这里应该有一个小修改，这里不应该是vm2 而是target或者protected vm 对应的vm1应该是compromised或者是controlled vm
2. 攻击者具有何种能力是这篇论文的核心：其攻击者最终具有的能力是能控制Hypervisor，至于其是通过何种方式来控制Hypervisor的，那么不应该是本文讨论的重点，重点是解决，攻击者已经掌握了Hypervisor。那么在图中，2.1）无论攻击者是内部管理员，即云平台的管理员要危害租户虚拟机内容的一种攻击场景，2.2） 或通过逃逸攻击攻击Hypervisor获取到了对应的权限，即攻击者掌握host os的某些漏洞，通过这些漏洞攻击了Hypervisor并获取了Hypervisor权限对应的是图中的从vm1的这条路径；2.3）或者攻击者是有利用dma的方式，利用DMA的漏洞，来具体映射内存的方式来危害对应的guest vm2的内存的方式来实现攻击。注意，在这里DMA方式来危害VMCS结构体的方式并不成立，因为该内存的访问只能通过特权指令，DMA并不具有该特权，所以，并不认为这种方式能危害是从host os到获取Hypervisor的一种可行的攻击方式。此外，同样认为，攻击者已经具有了host os的权限，因为其已经具有的Hypervisor的权限，而在KVM环境中，HOST和Hypervisor一般认为是一个整体。
上面的描述是否应该详细说明存疑，因为现实中的攻击多种多样，我们不能只限定这几种攻击，我们的假定就只应该是攻击者已经获取了Hypervisor的权限，至于是通过何种方式，是不是仅仅局限于上面的2.1到2.3的三种方式，都不重要，重要的是Hypervisor已经被攻陷了。
3. 为了实现上述目的，我们做的是什么？要明确的最关键的是，对于Hypervisor，其虚拟化最重要的功能是VMCS和EPT。VMCS包含所有的虚拟机运行的控制条件.EPT负责管理虚拟机的物理内存。对于攻击者，其已经掌握了hypervisor的权限，要进一步危害虚拟机，那么最直接的方法就是危害VMCS和EPT，那么问题是，其怎么危害VMCS和EPT？

4. 当攻击者已经获取了hypervisor的权限，其如何危害虚拟机，这是为什么要保护上述的VMCS EPT的原因。
在hypervisor中，常规的VMCS操作都是通过VMX指令完成的，一般不会通过直接的内存操作对VMCS结构体进行读写操作。
对于使用VMX指令实现对VMCS操作的保护。
要实现指令hook是不可行的，所以攻击者一定是可以执行对应的VMX指令的。即使现有的所有的代码，能编译成VMX的代码都已经被hook了，攻击者也可以通过引入LKM等方式引入VMX操作。所以这种操作并不能禁止攻击者对VMCS的读写操作。
对于后者，其通过常规内存对VMCS结构体进行读写操作，因为VMCS结构体已经被隐藏起来了，所以，其无法实现攻击。
下面讨论攻击者在已经掌握了hostos和hypervisor权限的前提下，如何实现对虚拟机的攻击。
对应图中的内容：1. 无论内部攻击者还是外部攻击者都是通过嵌入malicious code实现攻击的。既然可以嵌入代码，那么代码就分为两部分：一部分是可以直接编译成VMX指令的恶意代码，另外一种就是直接内存读写。对于一个已经完全掌握了hypervisor的攻击者而言，其并不需要再去知道VMCS具体在什么地方，直接通过VMX操作就可以实现了。


## 对于上述3 4的解决 ##
在本文中，VMCS EPT的hook采用的是最底层函数的hook，即对KVM函数的hook，对于一个攻击者，其即使嵌入恶意攻击代码，假定其使用高级语言，调用的是内核的系统函数，那么，其是无法绕过KVM的相关函数的，所以，仍然可以保证其操作是可以被hook，并进入隔离空间中。当然，假如其直接使用VMX相关指令，并不通过系统调用对应的kvm函数，则这种是无法防御的。对于进入隔离空间后，我们仍然无法鉴定当前操作是否是合法的，即攻击者也可以修改VMCS等，但是我们无法确定该修改是合法修改还是非法修改，对于这一点，需要在写作的时候小心规避。

# 简介部分写作思路 #
本文的题目为HyperPS: Privilege Sperate 重点应该是权限分离，所以要突出的是权限。
对于hypervisor，要突出其权限过高，漏洞过多的特点，当hypervisor不安全的时候，其可以危害上面的虚拟机。或者从虚拟机出发，当hypervisor不安全的时候，如何减少对其他虚拟机的危害。为此，提出了分离功能。
但是！！！！VMCS EPT是hypervisor的核心功能，将其分离了，那么hypervisor还有啥特权或者说功能，所以，这个是不对的。那么权限的分离应该是针对hostos。要说hostos具有很多的脆弱性，其同时负责本身hostOS的各种功能，也要负责虚拟化相关的工作，当hostOS上存在其他脆弱性的时候，会导致其负责的虚拟化的功能也受到影响，为了，在本文中我们提出了要将HostOS的虚拟化的功能剥离的思想。

基于上说的内容，则写作的思路应该如下：
1. 很简洁的分析HostOS承担的功能，这些功能即包括kernel的功能，同时也包括虚拟化相关的功能。然后说明其存在广泛的脆弱性，这些脆弱性大多存在于内核本身而非虚拟化部分，但是，当攻击者成功exploit内核本身的脆弱性之后，同样也会导致虚拟化相关的权限的(这里不要说功能 要说权限，跟题目想符合)沦陷。从而使得虚拟机的安全不在能够得到保证。
2. 针对上述的现象，目前业界都做了哪些努力，提出了哪些方案，这些方案存在什么问题？这要点出来。进而引出自己的方案。
3. 提出自己的方案，并强调自己的优势。
<!-- 基于上述的原因，我们提出了 -->



















